<html>
<head>
<title>
Api Automation
</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
<style>
thead > tr > th {
	text-align: center;
}
tbody {
	text-align: center;
}
</style>
</head>
<body>
 <div class="container" style="background-color:#BBDEFB;">
 <!--  one  #BBDEFB -->

      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">API automation</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Home</a></li>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>
</ul>

      <!-- Main component for a primary marketing message or call to action -->
              <div class="btn-group pull-right" role="group">
  <button type="button" id="add" class="btn btn-default"  data-toggle="modal" data-target="#addmodal">Add</button>
  <button type="button"  id="update"class="btn btn-default"  data-toggle="modal" data-target="#updatemodal">Update</button>
  <button type="button"  id="delete" class="btn btn-default" >Delete</button>
  <button type="button"  id="run" class="btn btn-default">Run</button>
  <button type="button"  class="btn btn-default"><a href="/reports" target="blank">View Reports</a></button>
  <button type="button"  class="btn btn-default"><a href="/readme" target="blank">Readme</a></button>
  <button type="button"  id="upload"class="btn btn-default"  data-toggle="modal" data-target="#uploadmodal">Upload</button>
</div>

   <div class="jumbotron" 	>
<table id="listoftests" class="table table-striped table-bordered" style="background-color:#84FFFF;"              data-search="true"
           data-show-refresh="true"
           data-show-toggle="true"
           data-minimum-count-columns="3"
           data-show-pagination-switch="false"
           data-pagination="true"
           data-page-list="[10,25, 50, 100, ALL]"
           data-show-footer="false"
           data-side-pagination="client"
           data-url="/getMethodList">
<tbody>

</tbody>
</table>

</div>
<div class="modal fade" id="addmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title" id="exampleModalLabel">Add test Class</h3>
     
      </div>
      <div class="modal-body">
      <div class="row">
			<div class="col-sm-8">
			<label for="testmethodadd">Test Class</label>
			<input type="text" class="form-control" id="testmethodadd" placeholder="PackageName.ClassName"/>
			</div>       
	  </div>
	  <div class="row">
			<div class="col-sm-8">
			<label for="testmethoddesc">Test description</label>
			<input type="text" class="form-control" id="testmethoddesc" placeholder="Test Description"/>
			</div>       
	  </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="savetest">Save changes</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="updatemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      <h3 class="modal-title" id="exampleModalLabel">Update test Class</h3> 
     
      </div>
      <div class="modal-body">
      <div class="row">
			<div class="col-sm-8">
			<label for="testupdid">Test Class ID:</label>
			<input type="text" class="form-control" id="testupdid" disabled/>
			</div>       
	  </div>
      <div class="row">
			<div class="col-sm-8">
			<label for="testupdmethod">Test Class</label>
			<input type="text" class="form-control" id="testupdmethod" placeholder="PackageName.ClassName"/>
			</div>       
	  </div>
	  <div class="row">
			<div class="col-sm-8">
			<label for="testupdmethoddesc">Test description</label>
			<input type="text" class="form-control" id="testupdmethoddesc" placeholder="Test Description"/>
			</div>       
	  </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="updatetest">Save changes</button>
      </div>
    </div>
  </div>
</div>


</div>
    </div> 

</body>
<script type="text/javascript">
var testToRunOrDelete = [];
function getHeight() {
        return 600;
}

$('#listoftests').bootstrapTable({
	 height: getHeight(),
	 onCheckAll:function(rows){
		$.each(rows,function(k,v){
			testToRunOrDelete.push(v.testMethodId);
			testToRunOrDelete = jQuery.unique( testToRunOrDelete );
		}) ;
		console.log(testToRunOrDelete);
	 },
	onCheck:function(row,element){
		testToRunOrDelete.push(row.testMethodId);
		},
	 onUncheckAll:function(rows){
		 $.each($("input[name='btSelectItem']").parent().next(),function(k,v){
			 var id= $(v).text();
			 testToRunOrDelete=jQuery.grep(testToRunOrDelete,function(val){
					return val!=id;
				});
				 });
		console.log(testToRunOrDelete);
	},
	 onUncheck:function(row,element){
		 testToRunOrDelete=jQuery.grep(testToRunOrDelete,function(val){
				return val!=row.testMethodId;
			});
		 console.log(testToRunOrDelete);
			 },
		onRefresh:function(params){
			testToRunOrDelete=[];
		},
    columns: [
    {
        checkbox: true
    },
    {
        field: 'testMethodId',
        title: 'Test ID'
    }, {
        field: 'testMethodName',
        title: 'Test Method Name'
    }, {
        field: 'testMethodDescription',
        title: 'Description'
    }],
   
url: "/getMethodList"
});

$("#run").click(function(){
	$("#run").text("Running...");
$.ajax({
	  method: "POST",
	  url: "/runMethodList",
	  contentType:"application/json",
	  dataType:"json",
	  data: JSON.stringify(jQuery.unique(testToRunOrDelete)),
	  success:function( data ) {
		 // testToRunOrDelete=[];
		  sweetAlert( data.status);	
		  $("#run").text("Run");
	  }
	})
});

$("#add").click(function(){
	$("#testmethodadd").val(''),
	$("#testmethoddesc").val('')
});

$("#update").click(function(){
	$("#testupdmethod").val(''),
	$("#testupdmethoddesc").val('')
});
$("#savetest").click(function(){
var postData= {
	'testMethodName':$("#testmethodadd").val(),
	'testMethodDescription':$("#testmethoddesc").val()
}
console.log("Adding tests:");

console.log(postData);
$.ajax({
	  method: "POST",
	  url: "/addTestMethod",
	  contentType:"application/json",
	  dataType:"json",
	  data: JSON.stringify(postData),
	    success:function( data ) {
	    	$("button[title='Refresh']").click();
		  sweetAlert( data.status);	
	    }
	})
});

$("#update").click(function(){
var selectedTest= $("input[name='btSelectItem']:checked").parent().first();

$("#testupdid").val($(selectedTest).next().text());
$("#testupdmethod").val($(selectedTest).next().next().text());
$("#testupdmethoddesc").val($(selectedTest).next().next().next().text());
});


$("#updatetest").click(function(){
var updateData =  {
    'testMethodId': $("#testupdid").val(),
    'testMethodName': $("#testupdmethod").val(),
    'testMethodDescription': $("#testupdmethoddesc").val()
  }
  console.log(updateData);
$.ajax({
	  method: "PUT",
	  url: "/updateTestMethod",
	  contentType:"application/json",
	  dataType:"json",
	  data: JSON.stringify(updateData),
	    success:function( data ) {
		  sweetAlert( data.status);	
		  $("button[title='Refresh']").click();
	    }
	})
});

$("#delete").click(function(){
$.ajax({
	  method: "DELETE",
	  url: "/removeTestMethod",
	  contentType:"application/json",
	  dataType:"json",
	  data: JSON.stringify(jQuery.unique(testToRunOrDelete)),
	    success:function( data ) {
		  sweetAlert( data.status);	
		  //testToRunOrDelete=[];
		  $("button[title='Refresh']").click();
	    }
	})
});
</script>

</html>
